\documentclass{book}
\input{preamble.tex}
\begin{document}
\chapter{Tree-edge Triage}\label{statement}
Aaron and Beren are playing a game that takes place within an infinite binary tree. At the start of the game every edge in the tree is independently labeled $A$ with probability $p$  and $B$ otherwise.\footnote{On average, then, $p$ represents the proportion of edges in the tree that are labeled $A$.} Both players are able to inspect all (infinitely many) of these labels $\ldots$ somehow. Then, starting with Aaron at the root, the players alternate turns moving a shared token down the tree (each turn the active player selects from the two descendants of the current node and moves the token along the edge to that node). If the token ever traverses an edge labeled $B$, Beren wins the game. Otherwise, Aaron wins.\footnote{This is the August 2024 puzzle, BTW, which can be found at \url{https://www.janestreet.com/puzzles/tree-edge-triage-index/}}

\begin{figure}[ht]
\centering
\begin{tikzpicture}
[
    scale = 1.1,
    level 1/.style={sibling distance=42mm, level distance = 1.2cm},
    level 2/.style={sibling distance=22mm, level distance = 2.1cm},
    level 3/.style={sibling distance = 10mm, level distance = 1cm},
    level 4/.style={sibling distance = 5mm, level distance = .9cm},
    ellip/.style={text height = 4mm},
    game/.style={circle, draw, minimum size = .35cm, fill = none},
    whole/.style={draw=black, very thick, inner sep = 25pt, text height = 0mm},
    sub/.style={dashed, draw=black, very thick, inner sep=15pt}, % Style for grouping
    ssub/.style={draw = black, very thick, inner sep = 3pt},
    arrow/.style={draw, ->, color = RoyalBlue, line width = 1.7pt},
]

% Draw the binary tree with an edge label
\node[game] (root) {}
	child {node[game](11) {}
		child {node[game] {}
			child {node[game] {}
				child {node[ellip] {\bigdots}}
				child {node[ellip] {\bigdots}}
			edge from parent node [left] {$A$}
				}
			child {node[game] {}
				child {node[ellip] {\bigdots}}
				child {node[ellip] {\bigdots}}
			edge from parent node [right] {$B$}
				}
	edge from parent node [left] {$A$}
			}
		child {node[game](22) {}
			child {node[game] {}
				child {node[ellip] {\bigdots}}
				child {node[ellip] {\bigdots}}
			edge from parent node [left] {$B$}
				}
			child {node[game](34) {}
				child {node[ellip] {\bigdots}}
				child {node[ellip] {\bigdots}}
			edge from parent node [right] {$B$}
				}
		edge from parent node [right] {$A$}
			}
	edge from parent node [above] {$A$}
	}
	child {node[game] {}
		child {node[game] {}
			child {node[game] {}
				child {node[ellip] {\bigdots}}
				child {node[ellip] {\bigdots}}
			edge from parent node [left] {$B$}
				}
			child {node[game] {}
				child {node[ellip] {\bigdots}}
				child {node[ellip] {\bigdots}}
			edge from parent node [right] {$A$}
				}
		edge from parent node [left] {$B$}
			}
		child {node[game] {}
			child {node[game] {}
				child {node[ellip] {\bigdots}}
				child {node[ellip] {\bigdots}}
			edge from parent node [left] {$B$}
				}
			child {node[game](s) {}
				child {node[ellip] {\bigdots}}
				child {node[ellip] {\bigdots}}
			edge from parent node [right] {$A$}
				}
		edge from parent node [right] {$A$}
			}
	edge from parent node [above] {$B$}
	};
	\draw[arrow] (root) -- (11);
	\draw[arrow] (11) -- (22);
	\draw[arrow] (22) -- (34);
\end{tikzpicture}
\caption{An example game: Aaron chooses to go left to avoid immediate defeat. However, after Beren goes right, Aaron is forced to choose one of two $B$-edges, and Beren wins.}
\label{exGame}
\end{figure}

\begin{question*}\label{infimum}
What is the infimum of the set of probabilities $p$ for which Aaron has a nonzero probability of winning the game?
\end{question*}
This question is kind of dense for the sake of rigor that isn't that important right now. So here's another way to put it: what is the smallest average proportion of edges in the tree labelled $A$ such that Aaron still has a chance of winning?

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%SECTION%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Solution}\label{solution}
Rather than tackling the entire infinite problem right away (which could be overwhelming), we first consider finite games restricted to finite binary trees. For these games we define the following events:
\begin{itemize}
\item Let $X_n$ denote Aaron wins a game that starts on \textbf{his} turn and lasts $n$ rounds.
\item Let $Y_n$ denote Aaron wins a game that starts on \textbf{Beren's} turn and lasts $n$ rounds.
\item Let $A_{\text{e}}$ denote edge $e$ is labelled $A$.
\end{itemize}
Now let's find some probabilities. The simplest one is $P(A_{e})$, which, by definition, is $p$ for any edge $e$. Next, it is clear that $X_1$ occurs when at least one of the two edges from the root, $e_1$ or $e_2$, is labeled $A$. Thus,
\begin{align*}
P(X_1) &= P(A_{e_1} \cup A_{e_2})\\
&= P(A_{e_1}) + P(A_{e_2})- P(A_{e_1} \cap A_{e_2})\\
&= 2p - p^2.
\end{align*}
Similarly, $Y_1$ occurs when both edges from the root are labelled $A$ (otherwise, Beren wins). Thus,
\[P(Y_1) = P(A_{e_1} \cap A_{e_2}) = p^2.\]
Why stop with $P(X_1)$ and $P(Y_1)$? Let's try to find $P(X_2)$. We could apply the same reasoning that got us $P(X_1)$, noting that $X_2$ occurs when either $e_1$ and its subsequent edges are labelled $A$ or $e_2$ and its subsequent edges are labelled A. But this approach becomes unwieldy as we consider more and more rounds. It would be nice if we could express $P(X_2)$ using what we already found---namely, $P(X_1)$ and $P(Y_1)$. And indeed, we can! The key is to realize that our events are composed of identical sub-events (see Figure \ref{subgames}), thanks to all the edges being labelled independently.
\begin{figure}[ht]
\centering
\begin{tikzpicture}
[
scale = 1,
level 1/.style={sibling distance=42mm, level distance = 1.2cm},
level 2/.style={sibling distance=18mm, level distance = 1.5cm},
level 3/.style={sibling distance = 8mm, level distance = 1cm},
ellip/.style={text height = 4mm},
game/.style={circle, draw, minimum size = .35cm, fill = none},
whole/.style={draw=black, thick, inner sep = 12pt, text height = 0mm},
sub/.style={dashed, draw=black, thick, inner sep=7pt}, % Style for grouping
ssub/.style={draw = black, thick, inner sep =2pt},
sssub/.style={dashed, draw = black, thick, inner sep = 3pt},
arrow/.style={draw, ->, color = RoyalBlue, line width = 1.7pt},
]

% Draw the binary tree with an edge label
\node[game] (root) {}
	child {node[game](11) {}
		child {node[game](21){}
			child {node[ellip](31) {\bigdots}
				}
			child {node[ellip](32) {\bigdots}
				}
			}
		child {node[game](22) {}
			child {node[ellip](33) {\bigdots}
				}
			child {node[ellip](34) {\bigdots}
				}
			}
	}
	child {node[game](12) {}
		child {node[game](23){}
			child {node[ellip](35) {\bigdots}
				}
			child {node[ellip] (36){\bigdots}
				}
			}
		child {node[game](24){}
			child {node[ellip](37) {\bigdots}
				}
			child {node[ellip](38) {\bigdots}
				}
			}
	};
\node[whole, label=above:{$X_n$}, fit = (root)(31)(38)] {};
\node[sub, label=above:{$Y_{n-1}$}, fit = (11)(21)(22)(31)(34)]{};
\node[sub, label=above:{$Y_{n-1}$}, fit = (12)(23)(24)(35)(38)]{};
\node[ssub, label = above:{$X_{n-2}$}, fit = (21)(31)(32)]{};
\node[ssub, label = above:{$X_{n-2}$}, fit = (22)(33)(34)]{};
\node[ssub, label = above:{$X_{n-2}$}, fit = (23)(35)(36)]{};
\node[ssub, label = above:{$X_{n-2}$}, fit = (24)(37)(38)]{};
\end{tikzpicture}
\caption{The sub-events of $X_n$}
\label{subgames}
\end{figure}

Thus, $X_2$ occurs if $e_1$ is labelled $A$ and Aaron \emph{wins the rest of the game after traversing $e_1$} ($Y_1$) or $e_2$ is labelled $A$ and Aaron \emph{wins the rest of the game after traversing $e_2$} ($Y_1$). That is,
\begin{align*}
P(X_2) &= P((A_{e_1} \cap Y_1) \cup (A_{e_2} \cap Y_1))\\
&= P(A_{e_1} \cap Y_1) + P(A_{e_2} \cap Y_1) - P((A_{e_1} \cap Y_1) \cap (A_{e_2} \cap Y_1))\\
&= 2pP(Y_1) - p^2P(Y_1)^2.
\end{align*}
Similarly,
\begin{align*}
P(Y_2) &= P((A_{e_1} \cap X_1) \cap (A_{e_2} \cap X_1))\\ 
P(Y_2) &= p^2P(X_{1})^2.
\end{align*}

But wait a second. Was there anything stopping us just now from writing $X_n$ instead of $X_2$ and $Y_{n-1}$ instead of $Y_1$ or $Y_n$ instead of $Y_2$ and $X_{n-1}$ instead of $X_1$? Absolutely not! This means that
\begin{gather}
P(X_n) = 2pP(Y_{n-1}) - p^2P(Y_{n-1})^2\text{ and}\label{xn}\\
P(Y_n) = p^2P(X_{n-1})^2.\label{yn}
\end{gather}

\begin{figure}[ht]
\centering
\begin{tikzpicture} \begin{axis}[
	colormap/cool,
	xlabel=$x$,
	ylabel=$p$,
	zlabel = $z$,
	zmin = -.15,
	zmax = 1,
    	title={$p^6x^4-2p^3x^2 + x$},
	view = {235}{30},
    	domain=0:1,
	y domain =0:1
]
\addplot3 [surf,thick,samples=25] {y^6*x^4 - 2*y^3*x^2 + x};
\end{axis}
\end{tikzpicture}
\caption{something}
\end{figure}



We now return to the infinite game. To answer question \ref{infimum}, we need to determine for which values of $p$ $P(X_\infty) > 0$. First, let's find $P(X_\infty)$. If we take the limit as $n$ approaches infinity in \eqref{xn} then substitute in the value of $P(Y_n)$ from \eqref{yn}, we get
\begin{align*}
P(X_\infty) &= 2pP(Y_{\infty-1}) - p^2P(Y_{\infty-1})^2\\
&= 2p\Big(p^2P(X_{\infty-2})^2\Big) - p^2\Big(p^2P(X_{\infty-2})^2\Big)^2\\
&= 2p^3P(X_{\infty-2})^2 - p^6P(X_{\infty-2})^4.
\end{align*}
$P(X_\infty) = P(X_{\infty-2})$, and we still don't know what $P(X_\infty)$ is, so let it be $x$. Then we have $x = 2p^3x^2 - p^6x^4$ or, after rearranging terms,
\begin{equation*}
x(p^6x^3 - 2p^3x + 1) = 0.
\end{equation*}
We ignore the trivial solution $x = 0$ and set our sights on $p^6x^3 - 2p^3x + 1 = 0$. Let's remind ourselves what this equation represents. The possible values of $x$ that satisfy this equation are the possible values of $P(X_\infty)$. This is why we ignored $x=0$; we already know that Aaron's probability of winning can be $0$ (set $p = 0$, for example). 

The discriminant for a cubic polynomial of the form \[x^3 + ax^2 + bx + c\] is \[a^2b^2 + 18abc - 4b^3 - 4a^3c - 27c^2.\] Therefore
\begin{align*}
\Delta &= 0 + 0 -4b^3 - 0 - 27c^2\\
&=-4(-2p^{-3})^3 - 27(p^{-6})^2\\
&=2^5p^{-9} - 27p^{-12}.
\end{align*}

Setting $\Delta = 0$ and solving for $p$, we find that
\begin{align*}
2^5p&^{-9} = 27p^{-12}\\
2^5p&^3 = 3^3\\
p&^3 = 3^3\cdot 2^{-5}\\
p& = 3\cdot 2^{\frac{-5}{3}},
\end{align*}
which is our final answer.
\end{document}
